<?xml version="1.0" ?>
<odoo>
    <!-- This xml file generate reports of sale order and display product category wise. -->
    <template id="report_sales_order_document_inherit_product_refrence"
		  inherit_id ="sale.report_saleorder_document"	>
	<xpath expr="////tbody[@class ='sale_tbody']/t/t[2]" position="replace">	
	    <t t-set="product_category" t-value="[]"/>
	    <t t-foreach="doc.order_line" t-as="l">
		<t t-set="product_category" t-value="product_category+[l.product_id.categ_id]"/>
	    </t>
	    <t t-foreach="set(product_category)" t-as="category">
		<t t-foreach="doc.order_line" t-as="l">
		    <t t-if="category.id==l.product_id.categ_id.id">
			<tr>
			    <td><span t-field="l.product_id"/></td>
			    <td class="text-right">
			        <span t-field="l.product_uom_qty"/>
			        <span t-field="l.product_uom" groups="product.group_uom"/>
			    </td>
			    <td class="text-right">
				<span t-field="l.price_unit"/>
			    </td>
			    <td t-if="display_discount" class="text-right" groups="sale.group_discount_per_so_line">
				<span t-field="l.discount"/>
			    </td>
			    <td class="text-right">
				<span t-esc="', '.join(map(lambda x: (x.description or x.name), l.tax_id))"/>
			    </td>
			    <td class="text-right" groups="sale.group_show_price_subtotal">
				<span t-field="l.price_subtotal"  t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
			    </td>
			    <td class="text-right" groups="sale.group_show_price_total">
				<span t-field="l.price_total" t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
			    </td>
			</tr>
		    </t>
		</t>
	    </t>
	</xpath>
    </template>
</odoo>
